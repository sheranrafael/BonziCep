#!/usr/bin/env ruby

require 'bonzi_cep'
require 'optparse'

options = {}
OptionParser.new do |opts|
  opts.banner = "Uso: bonzi_cep [opÃ§Ãµes]"

  opts.on("-g", "--gerar", "Gerar um CEP aleatÃ³rio") do
    options[:gerar] = true
  end

  opts.on("-eESTADO", "--estado=ESTADO", "Gerar CEP para um estado especÃ­fico") do |estado|
    options[:estado] = estado.upcase
  end

  opts.on("-cCEP", "--consulta=CEP", "Consultar um CEP") do |cep|
    options[:consulta] = cep
  end

  opts.on("-vCEP", "--validar=CEP", "Validar um CEP") do |cep|
    options[:validar] = cep
  end

  opts.on("-l", "--lista", "Listar estados suportados") do
    options[:lista] = true
  end

  opts.on("-h", "--help", "Mostrar ajuda") do
    puts opts
    puts "\nExemplos:"
    puts "  bonzi_cep -g                 # Gera CEP aleatÃ³rio"
    puts "  bonzi_cep -g -e SP           # Gera CEP para SÃ£o Paulo"
    puts "  bonzi_cep -c 01001-000       # Consulta um CEP"
    puts "  bonzi_cep -v 12345-678       # Valida um CEP"
    puts "  bonzi_cep -l                 # Lista estados suportados"
    exit
  end
end.parse!

if options[:gerar]
  begin
    if options[:estado]
      resultado = BonziCEP.gerar_para_estado(options[:estado])
      puts "\nğŸ“ CEP Gerado para #{resultado[:estado]}:"
    else
      resultado = BonziCEP.gerar
      puts "\nğŸ“ CEP AleatÃ³rio Gerado:"
    end
    
    puts "â”œâ”€ CEP: #{resultado[:cep]}"
    puts "â”œâ”€ Estado: #{resultado[:estado]}"
    puts "â””â”€ RegiÃ£o: #{resultado[:regiao]}"
    
  rescue BonziCEP::EstadoInvalido => e
    puts "\nâŒ Erro: #{e.message}"
    puts "Use 'bonzi_cep -l' para ver estados vÃ¡lidos"
  end
  
elsif options[:consulta]
  begin
    resultado = BonziCEP.consultar(options[:consulta])
    puts "\nğŸ” Consulta CEP #{resultado[:cep]}:"
    puts "â”œâ”€ Estado: #{resultado[:estado]}"
    puts "â””â”€ RegiÃ£o: #{resultado[:regiao]}"
  rescue BonziCEP::CEPInvalido => e
    puts "\nâŒ Erro: #{e.message}"
  end
  
elsif options[:validar]
  valido = BonziCEP.valido?(options[:validar])
  puts "\n#{valido ? 'âœ…' : 'âŒ'} O CEP #{options[:validar]} Ã© #{valido ? 'vÃ¡lido' : 'invÃ¡lido'}"
  
  if valido
    begin
      estado = BonziCEP.consultar(options[:validar])[:estado]
      puts "â”œâ”€ Pertence ao estado: #{estado}"
      puts "â””â”€ RegiÃ£o: #{BonziCEP::REGIOES_POR_ESTADO[estado]}"
    rescue
      puts "â””â”€ (Estado nÃ£o identificado)"
    end
  end
  
elsif options[:lista]
  puts "\nğŸ‡§ğŸ‡· Estados Suportados:"
  BonziCEP.estados_suportados.each do |estado|
    puts "â”œâ”€ #{estado}: #{BonziCEP::REGIOES_POR_ESTADO[estado]}"
  end
  puts "â””â”€ Total: #{BonziCEP.estados_suportados.size} estados"
  
else
  puts "Use -h para ver as opÃ§Ãµes disponÃ­veis"
end